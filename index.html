<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Wallet Prank</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">
  <style>
    /* === UPDATED CSS === */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      background: #000; 
      color: white; 
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      height: 100vh;
      overflow: hidden;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      height: 80px;
      position: relative;
      z-index: 100;
    }

    .title {
      font-size: 34px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .controls { display: flex; gap: 8px; }

    .control-btn {
      width: 44px;
      height: 44px;
      background: #ffffff;
      border-radius: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .control-btn img {
      width: 24px;
      height: 24px;
      display: block; /* Fix icon visibility */
    }

    #cardContainer {
      position: relative;
      height: calc(100vh - 100px);
      overflow-y: auto;
      padding: 0 12px;
    }

    .card {
      width: 100%;
      max-width: 375px;
      margin: 0 auto;
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
      position: absolute;
      left: 0;
      right: 0;
    }

    .card[data-type="credit"] { aspect-ratio: 1084/684; }
    .card[data-type="loyalty"] { aspect-ratio: 1066/1491; }

    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .card:not(.active) {
      transform: translateY(var(--offset)) scale(0.98);
      z-index: calc(100 - var(--index));
    }

    .card.active {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%)!important;
      z-index: 999;
      max-height: 80vh;
      width: 94%;
    }

    #done-btn {
      position: fixed;
      top: 24px;
      left: 24px;
      color: white;
      font-size: 20px;
      background: transparent;
      border: none;
      z-index: 1000; /* Higher than cards */
      display: none;
    }

    #done-btn.visible { display: block; }

    .popup {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #1c1c1e;
      padding: 1.5rem 1rem;
      border-radius: 24px 24px 0 0;
      transform: translateY(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .popup.visible { transform: translateY(0); }
    .popup button {
      width: 100%;
      padding: 1rem;
      background: #363638;
      color: white;
      border: none;
      border-radius: 12px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <header>
    <h1 class="title">Wallet</h1>
    <div class="controls">
      <div class="control-btn" id="addBtn">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkElEQVR4nO2UMQ6AIAxFPYkHcHNP4uYhPIKbehJP4sYJXNTGRWmiEIR+WlrkLS3l8QkF/kuAeQB4BQTA2BkHMLQqXhVY0jQ7k0s7wK4EeE0eGxM5Zg9oHtB8wKcBc0r6M0D0gJ0DlD0gO4B7QPEB1QHCA5QDlAdIDpAdoDlAcYDqAM0BmgN0B+gOMD7APB0J6B7gHwAAAABJRU5ErkJggg==" alt="+">
      </div>
      <div class="control-btn">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAi0lEQVR4nO2UMQrAIAxFPYmXcHNP4uYhPIKbehJP4sYJXNTGRWmiEIR+WlrkLS3l8QkFvifAPAA8AgJgbI0D6FsVjwosaZqNyaUdYFEC3CaPjYkcswM0B2gO0BygOUBzgOYA1QGaAzQHaA7QHKA5QHGA4gDFAYoDFAcoDlAcoDhAcYDiAMUBigM0B+gO0P8A83Qk1C9jqy8AAAAASUVORK5CYII=" alt="â‹¯">
      </div>
    </div>
  </header>

  <div id="cardContainer"></div>
  <button id="done-btn">Done</button>

  <div id="popup" class="popup">
    <button id="addCreditBtn">Add Credit/Debit Card</button>
    <button id="addLoyaltyBtn">Add Loyalty Card</button>
    <button id="cancelBtn">Cancel</button>
  </div>

  <script>
    // === UPDATED JAVASCRIPT ===
    let cards = [];
    const CARD_OFFSET = 30;

    function updateCardPositions() {
      cards.forEach((card, index) => {
        card.style.setProperty('--offset', `${index * CARD_OFFSET}px`);
        card.style.setProperty('--index', index);
      });
    }

    document.getElementById('addBtn').addEventListener('click', () => {
      document.getElementById('popup').classList.add('visible');
    });

    document.getElementById('addCreditBtn').addEventListener('click', () => addCard(false));
    document.getElementById('addLoyaltyBtn').addEventListener('click', () => addCard(true));
    document.getElementById('cancelBtn').addEventListener('click', () => {
      document.getElementById('popup').classList.remove('visible');
    });

    document.getElementById('done-btn').addEventListener('click', () => {
      cards.forEach(card => {
        card.classList.remove('active');
        card.style.display = 'block';
      });
      updateCardPositions();
      document.querySelector('header').style.display = 'flex';
      document.getElementById('done-btn').classList.remove('visible');
    });

    function addCard(isLoyalty) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = e => createCard(e.target.files[0], isLoyalty);
      input.click();
    }

    function createCard(file, isLoyalty) {
      const reader = new FileReader();
      reader.onload = e => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.type = isLoyalty ? 'loyalty' : 'credit';
        
        const img = new Image();
        img.src = e.target.result;
        card.appendChild(img);

        card.addEventListener('click', () => {
          cards.forEach(c => {
            c.style.display = c === card ? 'block' : 'none';
          });
          card.classList.add('active');
          document.querySelector('header').style.display = 'none';
          document.getElementById('done-btn').classList.add('visible');
        });

        cards.push(card);
        document.getElementById('cardContainer').appendChild(card);
        updateCardPositions();
        document.getElementById('popup').classList.remove('visible');
      };
      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>
